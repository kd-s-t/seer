services:
  expressjs:
    build:
      context: ./expressjs
      dockerfile: Dockerfile
    ports:
      - "3016:3016"
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PORT=3016
      - NETWORK=${NETWORK:-testnet}
      - BNB_TESTNET_RPC=${BNB_TESTNET_RPC}
      - CONTRACT_ADDRESS=${CONTRACT_ADDRESS}
    volumes:
      - ./expressjs:/app
    depends_on:
      - nextjs

  nextjs:
    build:
      context: ./nextjs
      dockerfile: Dockerfile
    ports:
      - "3015:3015"
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:3016
      - PORT=3015
    volumes:
      - ./nextjs:/app
      - /app/node_modules
      - /app/.next

  bnb:
    build:
      context: ./bnb
      dockerfile: Dockerfile
    ports:
      - "8545:8545"  # Hardhat node default port
    environment:
      - PRIVATE_KEY=${PRIVATE_KEY}
      - BNB_TESTNET_RPC=${BNB_TESTNET_RPC}
      - BNB_MAINNET_RPC=${BNB_MAINNET_RPC}
    volumes:
      - ./bnb:/app
      - /app/node_modules
      - /app/artifacts
      - /app/cache
    command: tail -f /dev/null  # Keep container running for manual commands
    profiles:
      - tools  # Only start when explicitly requested
